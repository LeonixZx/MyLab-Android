<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyLAB</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <style>
        :root {
            /* Theme Colors */
            --bg-light: #f8f9fa;
            --card-light: rgba(255, 255, 255, 0.7);
            --text-light: #2d3436;
            --border-light: rgba(0, 0, 0, 0.1);
            
            --bg-dark: #1a1b1e;
            --card-dark: rgba(45, 52, 54, 0.7);
            --text-dark: #ffffff;
            --border-dark: rgba(255, 255, 255, 0.1);
            
            /* Calculator Card Colors */
            --log-reduction: linear-gradient(135deg, #FF9A9E 0%, #FAD0C4 100%);
            --dilution: linear-gradient(135deg, #A18CD1 0%, #FBC2EB 100%);
            --cfu: linear-gradient(135deg, #FFD1A1 0%, #FFA07A 100%);
            --media: linear-gradient(135deg, #84FAB0 0%, #8FD3F4 100%);
            
            /* Fixed heights */
            --header-height: 64px;
            --footer-height: 60px;
            --search-height: 60px;
            --content-height: calc(100vh - var(--header-height) - var(--footer-height));
            --transition-speed: 0.3s;
			
			--page-transition: 400ms cubic-bezier(0.4, 0, 0.2, 1);
			--scale-transition: 300ms cubic-bezier(0.4, 0, 0.2, 1);
			--fade-transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);			
			
        }

		* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        html, body {
            height: 100vh;
            overflow: hidden;
            background-color: var(--bg-light);
            -webkit-text-size-adjust: 100%;
        }

        body {
            color: var(--text-light);
            transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        body.dark {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        /* Enhanced Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            z-index: 1000;
            background: var(--card-light);
            border-bottom: 1px solid var(--border-light);
            transition: all var(--transition-speed) ease;
        }

        @supports (backdrop-filter: blur(10px)) {
            .navbar {
                backdrop-filter: blur(10px);
                background: rgba(255, 255, 255, 0.7);
            }

            .dark .navbar {
                background: rgba(45, 52, 54, 0.7);
            }
        }

        .dark .navbar {
            background: var(--card-dark);
            border-bottom: 1px solid var(--border-dark);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            height: 100%;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

		.nav-brand {
			display: flex;
			align-items: center;
			gap: 0.25rem;
			font-size: 1.25rem;
			font-weight: 600;
			position: relative;
			letter-spacing: -0.02em;
			padding: 0;
			font-weight: bold;
		}

		/* Add flat shadow below text */
		.nav-brand #typewriter {
			position: relative;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			color: transparent;
			display: inline-block;
		}

		.nav-brand .typewriter-cursor {
			display: inline-block;
			width: 2px;
			height: 1.2em;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			margin-left: 2px;
			vertical-align: middle;
			animation: blink 1s step-end infinite;
		}

		.dark .nav-brand .typewriter-cursor {
			background: linear-gradient(135deg, #A18CD1 0%, #FBC2EB 100%);
		}

		.nav-brand #typewriter::after {
			content: '';
			position: absolute;
			bottom: -4px;
			left: 0;
			width: 100%;
			height: 4px;
			background: linear-gradient(90deg, 
				transparent, 
				rgba(102, 126, 234, 0.2),
				rgba(102, 126, 234, 0.2), 
				transparent
			);
			border-radius: 4px;
		}

		.dark .nav-brand #typewriter::after {
			background: linear-gradient(90deg, 
				transparent, 
				rgba(118, 75, 162, 0.2),
				rgba(118, 75, 162, 0.2), 
				transparent
			);
		}

		.dark .nav-brand {
			text-shadow: 
				0 1px 2px rgba(118, 75, 162, 0.2),
				0 2px 4px rgba(118, 75, 162, 0.2),
				0 4px 8px rgba(118, 75, 162, 0.1),
				0 8px 16px rgba(118, 75, 162, 0.1);
		}

		.nav-brand::after {
			display: none;
		}

		.nav-brand:hover::after {
			transform: scaleX(1);
		}

		/* Smooth Calculator Section Transitions */
		.calculator-section {
			transition: opacity var(--fade-transition),
						transform var(--fade-transition);
			will-change: transform, opacity;
			min-height: calc(100vh - var(--header-height) - var(--search-height) - 3rem); /* Add this line */
		}

		.calculator-section[style*="display: none"] {
			transform: translateY(10px) scale(0.98);
			opacity: 0;
		}

		.calculator-section[style*="display: block"] {
			transform: translateY(0) scale(1);
			opacity: 1;
		}

        .nav-brand:hover {
            transform: none;
        }

        .nav-actions {
            display: flex;
            gap: 0.25rem;
        }

		/* Fix icon alignment */
		.nav-brand svg {
			color: #667eea;
			width: 32px;
			height: 32px;
			flex-shrink: 0;
		}

		.dark .nav-brand svg {
			color: #764ba2;
		}

        /* Enhanced Search Bar */
        .search-container {
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            height: var(--search-height);
            z-index: 999;
            background: var(--card-light);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 1rem;
            border-bottom: 1px solid var(--border-light);
            opacity: 0;
            transform: translateY(-10px);
            display: none;
			transition: 
				opacity var(--fade-transition),
				transform var(--fade-transition);
			will-change: transform, opacity;		
        }

        .calculator-page .search-container {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .dark .search-container {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        .search-wrapper {
            position: relative;
            max-width: 600px;
            width: 100%;
        }

        .search-input {
            width: 100%;
            height: 40px;
            padding: 0 1rem 0 3rem;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: inherit;
            font-size: 1rem;
            transition: all var(--transition-speed) ease;
            border: 1px solid var(--border-light);
        }

        .dark .search-input {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-dark);
        }

        .search-input:focus {
            outline: none;
            border-color: #A18CD1;
            box-shadow: 0 0 0 3px rgba(161, 140, 209, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            width: 20px;
            height: 20px;
            pointer-events: none;
            transition: all var(--transition-speed) ease;
        }

        /* Main Container */
		.container {
			position: fixed;
			top: var(--header-height);
			left: 0;
			right: 0;
			bottom: 0;
			overflow-y: auto;
			overflow-x: hidden;
			padding: 1.5rem;
			padding-bottom: 0; /* Changed from calc(...) */
			transition: padding-bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .calculator-page .container {
			top: calc(var(--header-height) + var(--search-height));
			height: auto; /* Changed from fixed height */
			min-height: calc(100vh - var(--header-height) - var(--search-height));
        }

        /* Page Layout */
		.page {
			position: absolute;
			width: 100%;
			height: calc(100% - var(--header-height));
			opacity: 0;
			visibility: hidden;
			transform: translateY(20px) scale(0.98);
			transition: 
				opacity var(--page-transition),
				transform var(--page-transition),
				visibility 0s linear var(--page-transition);
			will-change: transform, opacity;
		}

		.page.active {
			opacity: 1;
			visibility: visible;
			transform: translateY(0) scale(1);
			transition: 
				opacity var(--page-transition),
				transform var(--page-transition),
				visibility 0s linear;
			position: relative;
		}



		/* History Header Styling */
		.history-header {
			display: flex;
			align-items: flex-start;
			gap: 1rem;
			margin-bottom: 1.5rem;
			padding-bottom: 1rem;
			border-bottom: 1px solid var(--border-light);
		}

		.dark .history-header {
			border-color: var(--border-dark);
		}

		.history-icon {
			color: #667eea;
			width: 32px;
			height: 32px;
			flex-shrink: 0;
		}

		.dark .history-icon {
			color: #764ba2;
		}

		.history-title {
			position: relative;
			margin-bottom: 0.5rem;
			display: flex;
			align-items: center;
		}

		.dark #history-title::before,
		.dark #about-title::before {
			background: linear-gradient(90deg, 
				transparent, 
				rgba(118, 75, 162, 0.2),
				rgba(118, 75, 162, 0.2), 
				transparent
			);
		}

		#history-title,
		#about-title {
			position: relative;
			font-size: 1.25rem;
			font-weight: 600;
			display: inline-flex;
			align-items: center;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			color: transparent;
		}


		.title-shadow {
			position: absolute;
			bottom: -4px;
			left: 0;
			width: 0;
			height: 4px;
			background: linear-gradient(90deg, 
				transparent, 
				rgba(102, 126, 234, 0.2),
				rgba(102, 126, 234, 0.2), 
				transparent
			);
			border-radius: 4px;
			transition: width 0.3s ease;
		}



		/* Add flat shadow below History title */
		.history-title::before {
			content: '';
			position: absolute;
			bottom: -4px;
			left: 0;
			width: 100%;
			height: 4px;
			border-radius: 4px;
			transition: transform 0.3s ease;
		}

		.title-cursor {
			display: inline-block;
			margin-left: 2px;
			width: 2px;
			height: 1.2em;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			animation: blink 1s step-end infinite;
			opacity: 0.7;
		}


		/* Hover effects */
		.title-container:hover .title-shadow {
			transform: scaleX(1.1);
		}

		.dark .history-icon,
		.dark .about-header svg {
			color: #764ba2;
		}


		.dark .title-shadow {
			background: linear-gradient(90deg, 
				transparent, 
				rgba(118, 75, 162, 0.2),
				rgba(118, 75, 162, 0.2), 
				transparent
			);
		}

		.history-title:hover::before,
		#about-title:hover::before {
			transform: scaleX(1.1);
		}

		/* Dark mode adjustments */
		.dark .history-title::before,
		.dark #about-title::before {
		}

		/* Dark mode adjustments */
		.dark .history-title::before {
		}

		.history-description {
			font-size: 0.9rem;
			opacity: 0.7;
			line-height: 1.5;
			margin: 0;
		}

		/* Enhanced History List Styling */
		.history-list {
			display: flex;
			flex-direction: column;
			gap: 1rem;
		}

		.history-entry {
			position: relative;
			transition: transform var(--transition-speed) ease;
			margin-bottom: 1rem; /* Add this line */
		}

		.history-entry:hover {
			transform: translateY(-2px);
		}

		.history-empty {
			text-align: center;
			padding: 3rem 1rem;
			color: var(--text-light);
			opacity: 0.7;
		}

		.dark .history-empty {
			color: var(--text-dark);
		}
		


		.delete-history {
			position: absolute;
			top: 50%;
			right: 0.75rem;
			transform: translateY(-50%);
			width: 32px;
			height: 32px;
			border-radius: 8px;
			border: none;
			background: rgba(255, 87, 87, 0.1);
			color: #FF5757;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all var(--transition-speed) ease;
			z-index: 2;
			
		}

		.delete-history:hover {
			background: rgba(255, 87, 87, 0.2);
			transform: translateY(-50%) scale(1.05);
		}

		.delete-history svg {
			width: 16px;
			height: 16px;
			stroke-width: 2;
		}
		

        /* Enhanced About page styles */
        .about-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0rem;
            margin-top: 2rem;
        }

        .feature-card {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all var(--transition-speed) ease;
			margin-bottom: 1rem;
        }

        .dark .feature-card {
            border-color: var(--border-dark);
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 1rem;
            color: #A18CD1;
        }

        .feature-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: inherit;
        }

        .feature-description {
            font-size: 0.9rem;
            opacity: 0.7;
            line-height: 1.5;
        }


        /* Calculator Menu */
        .calculator-menu {
            position: relative;
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 2000px;
            margin: 1.5rem 0;  /* Adjusted spacing */
        }

        .calculator-list {
            position: relative;
            width: 280px;
            height: 280px;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Calculator Cards */
        .calculator-button {
            position: absolute;
            width: 280px;
            height: 280px;
            padding: 2rem;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            text-align: left;
            color: white;
            transform-style: preserve-3d;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
			transition: 
				transform var(--scale-transition),
				opacity var(--scale-transition),
				background-color var(--scale-transition);
			will-change: transform, opacity;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            touch-action: manipulation;
        }

        .calculator-button[data-calculator="logReduction"] { background: var(--log-reduction); }
        .calculator-button[data-calculator="dilution"] { background: var(--dilution); }
        .calculator-button[data-calculator="cfu"] { background: var(--cfu); }
        .calculator-button[data-calculator="media"] { background: var(--media); }

        .calculator-button.active {
            transform: translate(-50%, -50%) scale(1) translateZ(40px);
            z-index: 4;
        }

        .calculator-button:not(.active) {
            transform: translate(-50%, -50%) scale(0.9) translateZ(-40px);
            opacity: 0.7;
            z-index: 1;
        }

        .calculator-button.prev {
            transform: translate(-100%, -50%) scale(0.8) translateZ(-80px);
            z-index: 2;
        }

        .calculator-button.next {
            transform: translate(0%, -50%) scale(0.8) translateZ(-80px);
            z-index: 2;
        }

        .calculator-button::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 24px;
            background: linear-gradient(45deg, 
                rgba(255,255,255,0.1), 
                rgba(255,255,255,0.2)
            );
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
        }

        .calculator-button:hover::before {
            opacity: 1;
        }

        .calculator-icon {
            width: 32px;
            height: 32px;
            stroke: white;
            stroke-width: 2;
            margin-bottom: 1rem;
        }

        .calculator-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
			margin-bottom: 1rem;
        }

        .calculator-description {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.4;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
			margin-bottom: 1rem;
        }

        /* Calculator Content */
        .calculator-content {
			max-width: 800px;
			margin: 0 auto;
			padding: 1rem;
			background: var(--card-light);
			border-radius: 24px;
			border: 1px solid var(--border-light);
			margin-bottom: 0; /* Changed from 1.5rem */
			transform: translateZ(0);
			backface-visibility: hidden;
        }

        @supports (backdrop-filter: blur(10px)) {
            .calculator-content {
                backdrop-filter: blur(10px);
            }
        }

        .dark .calculator-content {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

        /* Input Groups */
        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: inherit;
            opacity: 0.7;
        }

        .input-wrapper {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            border: 1px solid var(--border-light);
            transition: all var(--transition-speed) ease;
        }

        .dark .input-wrapper {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-dark);
        }

        .input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            color: inherit;
            font-size: 0.8rem;
        }

        .input:focus {
            outline: none;
        }

        .input-wrapper:focus-within {
            border-color: #A18CD1;
            box-shadow: 0 0 0 3px rgba(161, 140, 209, 0.2);
			transform: translateY(-2px);
			transition: transform var(--scale-transition);
        }

        .input-unit {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.7;
            font-size: 0.9rem;
            pointer-events: none;
        }

        /* Calculation Steps */
		.calculation-steps {
			margin-top: 1.5rem;
			padding: 1rem;
			background: rgba(255, 255, 255, 0.05);
			border-radius: 12px;
			border: 1px solid var(--border-light);
			animation: slideUp var(--transition-speed) ease-out;
			margin-bottom: 1rem;
		}

		.step {
			position: relative;
			padding: 1.25rem;
			background: rgba(255, 255, 255, 0.05);
			border-radius: 12px;
			border: 1px solid var(--border-light);
			margin-bottom: 1rem;
			transition: all var(--transition-speed) ease;
		}

        .step:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

		.step-number {
			position: absolute;
			top: -12px;
			left: -12px;
			width: 28px;
			height: 28px;
			border-radius: 50%;
			background: var(--dilution);
			color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: bold;
			font-size: 0.9rem;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.step-content {
			flex: 1;              /* Keep this existing property */
			width: 100%;          /* Add this new property */
		}

		.step-title {
			font-weight: 600;
			margin-bottom: 0.75rem;
			color: inherit;
			padding-left: 1rem;
		}

		.step-formula {
			font-family: monospace;
			padding: 0.75rem;
			background: rgba(0, 0, 0, 0.2);
			border-radius: 8px;
			margin: 0.5rem 0;
			overflow-x: auto;
			word-break: break-word;
			white-space: pre-wrap;
			font-size: 0.9rem;
			line-height: 1.4;
			background: rgb(119 119 119 / 10%);
		}

		.dark .step-formula {
			background: rgba(255, 255, 255, 0.1);
		}

        /* Result Display */
		.result {
			padding: 1.25rem 1rem;
			padding-right: 3rem; /* Space for delete button */
			background: #f6f2ff73;
			border-radius: 12px;
			border: 1px solid rgb(0 0 0 / 10%);
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			transform-origin: top;
			transition: 
				opacity var(--fade-transition),
				transform var(--fade-transition);
			will-change: transform, opacity;
		}

		.result[style*="display: none"] {
			transform: translateY(-10px) scale(0.98);
			opacity: 0;
		}

		.result[style*="display: block"] {
			transform: translateY(0) scale(1);
			opacity: 1;
		}

        .dark .result {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-dark);
			border-radius: 12px;
			border: 1px solid rgb(255 255 255 / 10%);
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .result-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #A18CD1;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
			max-width: calc(100% - 0.05rem);
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .result-note {
            font-size: 0.9rem;
            opacity: 1;
            line-height: 1.5;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Bottom Navigation */
		.bottom-nav {
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			height: var(--footer-height);
			background: var(--card-light);
			backdrop-filter: blur(10px);
			border-top: 1px solid var(--border-light);
			display: flex;
			justify-content: center;
			align-items: center;  /* Added for vertical centering */
			gap: 4rem;
			z-index: 1000;
			transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			transform: translateY(0);
			padding: 0 1rem;  /* Added padding */
			width: 100%;  /* Ensure full width */
		}


		.bottom-nav.hidden {
			transform: translateY(100%);
		}

		.bottom-nav.visible {
			transform: translateY(0);
		}

		/* Nav Toggle Button */
		.nav-toggle {
			position: fixed;
			bottom: 5.5rem;
			right: 2rem;
			width: 48px;
			height: 48px;
			border-radius: 24px;
			background: var(--dilution);
			border: none;
			color: white;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 1001;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
			transform: translateY(0);
			opacity: 0.5;
		}

		.nav-toggle.hidden {
			transform: translateY(calc(var(--footer-height) + 1rem));
		}

		.nav-toggle:hover {
			opacity: 0.5;

		}

		.nav-toggle svg {
			width: 24px;
			height: 24px;
			transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.nav-toggle.active svg {
			transform: rotate(180deg);
		}

		/* Dark mode adjustments */
		.dark .nav-toggle {
			background: var(--card-dark);
			border: 1px solid var(--border-dark);
		}


        .dark .bottom-nav {
            background: var(--card-dark);
            border-color: var(--border-dark);
        }

		.bottom-nav-item {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 0.1rem;
			color: inherit;
			opacity: 0.7;
			border: none;
			background: none;
			cursor: pointer;
			padding: 0.5rem;
			position: relative;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.bottom-nav-item::after {
			content: '';
			position: absolute;
			bottom: 0;
			left: 50%;
			width: 0;
			height: 3px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			transform: translateX(-50%);
			transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			border-radius: 4px 4px 0 0;
		}

		.bottom-nav-item.active::after {
			width: 50%;
		}

		.bottom-nav-item svg {
			width: 28px;
			height: 28px;
			transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.bottom-nav-item:hover svg {
			transform: translateY(-4px) scale(1.1);
			color: #667eea;
		}

        .bottom-nav-item.active {
            opacity: 1;
        }

		.bottom-nav-item.active svg {
			color: #667eea;
			animation: iconPulse 2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
		}

		.bottom-nav-item span {
			font-size: 0.8rem;
			font-weight: 500;
			transform: translateY(0);
			transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.bottom-nav-item:hover span {
			transform: translateY(-2px);
		}

        /* Icon Buttons */
        .icon-button {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: inherit;
            transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .icon-button::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, 
                rgba(255,255,255,0.1), 
                rgba(255,255,255,0.2)
            );
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
        }

		@keyframes iconPulse {
			0%, 100% {
				transform: scale(1) translateY(0);
			}
			50% {
				transform: scale(1.1) translateY(-4px);
			}
		}


		/* Add ripple effect */
		.bottom-nav-item .ripple {
			position: absolute;
			border-radius: 50%;
			transform: scale(0);
			animation: ripple 0.6s linear;
			background-color: rgba(102, 126, 234, 0.2);
		}

		@keyframes ripple {
			to {
				transform: scale(4);
				opacity: 0;
			}
		}

		/* Dark mode adjustments */
		.dark .bottom-nav-item::after {
			background: linear-gradient(135deg, #A18CD1 0%, #FBC2EB 100%);
		}

		.dark .bottom-nav-item.active svg,
		.dark .bottom-nav-item:hover svg {
			color: #A18CD1;
		}


        .icon-button:hover {
            transform: translateY(-0px);
        }

        .icon-button:hover::before {
            opacity: 1;
        }

        .icon-button svg {
            width: 20px;
            height: 20px;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Calculate Button */
        .calculate-button {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 24px;
            background: var(--dilution);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            margin-top: 1.5rem;
			margin-bottom: 1.0rem;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .calculate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

		.step-formula::-webkit-scrollbar {
			height: 4px;
		}

		.step-formula::-webkit-scrollbar-track {
			background: rgba(0, 0, 0, 0.1);
			border-radius: 2px;
		}

		.step-formula::-webkit-scrollbar-thumb {
			background: var(--dilution);
			border-radius: 2px;
		}

        /* Animations */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-6px);
            }
        }


		@keyframes blink {
			0%, 100% { opacity: 0.7; }
			50% { opacity: 0; }
		}



		/* About Header Styling */
		.about-header {
			position: relative;
			display: flex;
			align-items: center;
			gap: 0.5rem;
			margin-bottom: 1rem;
		}

		.about-header svg {
			color: #667eea;
			width: 32px;
			height: 32px;
			flex-shrink: 0;
		}

		.dark .about-header svg {
			color: #764ba2;
		}


		.dark #about-title::after {
			background: linear-gradient(90deg, 
				transparent, 
				rgba(118, 75, 162, 0.2),
				rgba(118, 75, 162, 0.2), 
				transparent
			);
		}



        /* Responsive Design */
        @media (max-width: 768px) {
            .calculator-list {
                width: 240px;
                height: 240px;
            }

            .calculator-button {
                width: 240px;
                height: 240px;
                padding: 1.5rem;
				backdrop-filter: none;
                -webkit-backdrop-filter: none;
            }

            .calculator-title {
                font-size: 1.25rem;
				font-size: 1.25rem;
                font-weight: 700;  /* Make text slightly bolder on mobile */
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
            }

            .calculator-description {
                font-size: 0.9rem;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
            }

            .bottom-nav {
                gap: 1.5rem;
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                background: var(--card-light);
				justify-content: space-around;  /* Even spacing on mobile */
				padding: 0 0.5rem;  /* Smaller padding on mobile */
            }
			
			
            .calculator-menu {
                touch-action: none;  /* Prevents default touch handling */
            }

            .calculator-content {
                margin-top: 1rem;
                z-index: 1;
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                background: var(--card-light);
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
            }			
			
			
			.step {
                padding: 1.5rem 1rem 1rem;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
			}
			
			.step-formula {
                font-size: 0.85rem;
                padding: 0.75rem 0.5rem;
                overflow-wrap: break-word;
                word-wrap: break-word;
                hyphens: auto;
			}
			
			.result {
                padding: 1.25rem 3rem 1.25rem 1rem;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
			}
			
			.delete-history {
				right: 0.5rem;
			}
			
			.result-value, .result-note {
                overflow-wrap: break-word;
                word-wrap: break-word;
                hyphens: auto;
                max-width: calc(100% - 0.05rem);
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
			}

			.nav-brand {
				font-size: 1.25rem;
				padding: 0.25rem 0.5rem;
				letter-spacing: -0.05rem;
			}

			.page {
				transform: translateY(10px) scale(0.99);
			}

			.calculator-section {
                padding: 1rem;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
			}
			
			.dark .calculator-content {
                background: var(--card-dark);
            }
			
            .calculator-title {
                font-weight: 700;  /* Make text slightly bolder on mobile */
            }
			
            .input, .result-value, .step-title {
                font-weight: 600;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
            }
			
			.bottom-nav-item::after {
				height: 2px;
			}		

            .search-container {
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                background: var(--card-light);
            }			
			
            .dark .search-container {
                background: var(--card-dark);
            }

            .dark .bottom-nav {
                background: var(--card-dark);
            }
			
            .search-input {
                backdrop-filter: none;
                -webkit-backdrop-filter: none;			
			}
					
			.nav-toggle {
				bottom: 4.75rem;
				right: 0.65rem;
				width: 40px;
				height: 40px;
				opacity: 0.5;
			}
			
			.nav-toggle svg {
				width: 20px;
				height: 20px;
			}
			
			.bottom-nav-item {
				padding: 0.25rem;  /* Reduced padding on mobile */
			}			
			
			.bottom-nav-item svg {
				width: 24px;  /* Slightly smaller icons on mobile */
				height: 24px;
			}
	
			.bottom-nav-item span {
				font-size: 0.75rem;  /* Smaller text on mobile */
			}
			
			.nav-toggle.hidden {
				transform: translateY(calc(var(--footer-height) + 0.5rem));
			}
			.nav-toggle:hover {
				opacity: 0.5;
			}
        }
    </style>
</head>

<body class="calculator-page">
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
				<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M6 18h8"/>
					<path d="M3 22h18"/>
					<path d="M14 22a7 7 0 1 0 0-14h-1"/>
					<path d="M9 14h2"/>
					<path d="M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z"/>
					<path d="M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3"/>
				</svg>
                <span id="typewriter"></span>
            </div>
            <div class="nav-actions">
                <button id="resetButton" class="icon-button" title="Reset Inputs">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                </button>
                <button id="darkModeToggle" class="icon-button" title="Toggle Theme">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="dark-mode-icon">
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- Search Container -->
    <div class="search-container">
        <div class="search-wrapper">
            <input type="text" id="calculatorSearch" class="search-input" placeholder="Search calculators...">
            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.3-4.3"/>
            </svg>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Calculator View -->
        <main class="main-content page active" id="calculatorPage">
            <!-- Calculator Menu -->
            <div class="calculator-menu">
                <div class="calculator-list" id="calculatorList">
                    <!-- Log Reduction Calculator Card -->
                    <button class="calculator-button active" data-calculator="logReduction">
                        <svg class="calculator-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        <div>
                            <div class="calculator-title">Log Reduction</div>
                            <div class="calculator-description">Calculate antimicrobial effectiveness</div>
                        </div>
                    </button>

                    <!-- Dilution Calculator Card -->
                    <button class="calculator-button" data-calculator="dilution">
                        <svg class="calculator-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 19h14.56l-5.069-8.577a2 2 0 0 1-.211-.896V2"/>
                            <path d="M8.5 2h7"/>
                            <path d="M7 16h10"/>
                        </svg>
                        <div>
                            <div class="calculator-title">Dilution Calculator</div>
                            <div class="calculator-description">Calculate solution concentrations</div>
                        </div>
                    </button>

                    <!-- CFU Calculator Card -->
                    <button class="calculator-button" data-calculator="cfu">
                        <svg class="calculator-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="4"/>
                            <path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8"/>
                        </svg>
                        <div>
                            <div class="calculator-title">CFU Calculator</div>
                            <div class="calculator-description">Colony counting and dilution factors</div>
                        </div>
                    </button>

                    <!-- Media Calculator Card -->
                    <button class="calculator-button" data-calculator="media">
                        <svg class="calculator-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 3h6v11a6 6 0 0 1-3 5.197A6 6 0 0 1 9 14V3"/>
                            <path d="M9 8h6"/>
                        </svg>
                        <div>
                            <div class="calculator-title">Media Preparation</div>
                            <div class="calculator-description">Calculate media components</div>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Calculator Content Area -->
            <div class="calculator-content">
                <!-- Log Reduction Calculator -->
                <div id="logReduction" class="calculator-section">
                    <div class="calculator-title">Log Reduction Calculator</div>
                    <p class="calculator-description">Calculate the log reduction of microorganisms after treatment</p>
                    
                    <div class="input-group">
                        <label class="input-label">Initial Count (CFU/mL)</label>
                        <div class="input-wrapper">
                            <input type="number" id="initialCount" class="input" placeholder="Enter initial count">
                            <span class="input-unit">CFU/mL</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Final Count (CFU/mL)</label>
                        <div class="input-wrapper">
                            <input type="number" id="finalCount" class="input" placeholder="Enter final count">
                            <span class="input-unit">CFU/mL</span>
                        </div>
                    </div>
                    
                    <button class="calculate-button" onclick="calculateLogReduction()">Calculate</button>
                    <div id="logReductionResult" class="result" style="display: none;"></div>
                </div>

                <!-- Dilution Calculator -->
                <div id="dilution" class="calculator-section" style="display: none;">
                    <div class="calculator-title">Dilution Calculator</div>
                    <p class="calculator-description">Calculate volumes for solution preparation</p>
                    
                    <div class="input-group">
                        <label class="input-label">Stock Concentration (%)</label>
                        <div class="input-wrapper">
                            <input type="number" id="stockConc" class="input" placeholder="Enter stock concentration">
                            <span class="input-unit">%</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Target Concentration (%)</label>
                        <div class="input-wrapper">
                            <input type="number" id="targetConc" class="input" placeholder="Enter target concentration">
                            <span class="input-unit">%</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Final Volume (mL)</label>
                        <div class="input-wrapper">
                            <input type="number" id="finalVolume" class="input" placeholder="Enter final volume">
                            <span class="input-unit">mL</span>
                        </div>
                    </div>
                    
                    <button class="calculate-button" onclick="calculateDilution()">Calculate</button>
                    <div id="dilutionResult" class="result" style="display: none;"></div>
                </div>

                <!-- CFU Calculator -->
                <div id="cfu" class="calculator-section" style="display: none;">
                    <div class="calculator-title">CFU Calculator</div>
                    <p class="calculator-description">Calculate Colony Forming Units with dilution factors</p>
                    
                    <div class="input-group">
                        <label class="input-label">Number of Colonies</label>
                        <div class="input-wrapper">
                            <input type="number" id="colonies" class="input" placeholder="Enter colony count">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Dilution Factor</label>
                        <div class="input-wrapper">
                            <input type="number" id="dilutionFactor" class="input" placeholder="e.g., 1000 for 10⁻³">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Plated Volume (mL)</label>
                        <div class="input-wrapper">
                            <input type="number" id="platedVolume" class="input" placeholder="Enter plated volume">
                            <span class="input-unit">mL</span>
                        </div>
                    </div>
                    
                    <button class="calculate-button" onclick="calculateCFU()">Calculate</button>
                    <div id="cfuResult" class="result" style="display: none;"></div>
                </div>

                <!-- Media Calculator -->
                <div id="media" class="calculator-section" style="display: none;">
                    <div class="calculator-title">Media Preparation</div>
                    <p class="calculator-description">Calculate reagent quantities for media preparation</p>
                    
                    <div class="input-group">
                        <label class="input-label">Final Volume (L)</label>
                        <div class="input-wrapper">
                            <input type="number" id="mediaVolume" class="input" placeholder="Enter final volume">
                            <span class="input-unit">L</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Concentration (mM)</label>
                        <div class="input-wrapper">
                            <input type="number" id="mediaConc" class="input" placeholder="Enter concentration">
                            <span class="input-unit">mM</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Molecular Weight (g/mol)</label>
                        <div class="input-wrapper">
                            <input type="number" id="molecularWeight" class="input" placeholder="Enter molecular weight">
                            <span class="input-unit">g/mol</span>
                        </div>
                    </div>
                    
                    <button class="calculate-button" onclick="calculateMedia()">Calculate</button>
                    <div id="mediaResult" class="result" style="display: none;"></div>
                </div>
            </div>
        </main>


		<!-- History View -->
		<div id="historyPage" class="page">
			<div class="calculator-content">
				<div class="history-header">
					<svg class="history-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
					</svg>
					<div>
						<div class="history-title">
							<span id="history-title"></span>
						</div>
						<p class="history-description">Track and restore your recent calculations</p>
					</div>
				</div>
				<div id="historyList"></div>
			</div>
		</div>

		<!-- About View -->
		<div id="aboutPage" class="page">
			<div class="calculator-content">
				<div class="about-header">
					<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M6 18h8"/>
						<path d="M3 22h18"/>
						<path d="M14 22a7 7 0 1 0 0-14h-1"/>
						<path d="M9 14h2"/>
						<path d="M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z"/>
						<path d="M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3"/>
					</svg>
					<span id="about-title"></span>
				</div>
				<p class="calculator-description">
					Your comprehensive calculator suite for microbiological calculations.
					Version 1.0.0
				</p>
				
				<div class="about-features">
					<div class="feature-card">
						<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
						</svg>
						<div class="feature-title">Accurate Calculations</div>
						<div class="feature-description">
							Precise log reduction and dilution calculations for reliable results
						</div>
					</div>
					
					<div class="feature-card">
						<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<circle cx="12" cy="12" r="4"/>
							<path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8"/>
						</svg>
						<div class="feature-title">CFU Analysis</div>
						<div class="feature-description">
							Advanced colony counting and dilution factor calculations
						</div>
					</div>
					
					<div class="feature-card">
						<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M12 3v7m0 4v7M3 12h7m4 0h7"/>
						</svg>
						<div class="feature-title">Media Preparation</div>
						<div class="feature-description">
							Precise media component calculations for perfect preparations
						</div>
					</div>
					
					<div class="feature-card">
						<svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
						</svg>
						<div class="feature-title">Calculation History</div>
						<div class="feature-description">
							Save and restore your previous calculations
						</div>
					</div>
				</div>
			</div>
		</div>
    </div>

	<!-- Bottom Navigation Toggle Button (separate from nav) -->
	<button class="nav-toggle" aria-label="Toggle navigation">
		<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
			<path d="M6 9l6 6 6-6"/>
		</svg>
	</button>

	<!-- Bottom Navigation -->
	<nav class="bottom-nav visible">
		<button class="bottom-nav-item active" data-page="calculator">
			<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<rect width="18" height="18" x="3" y="3" rx="2"/>
				<path d="M7 8h10M7 12h10M7 16h10"/>
			</svg>
			<span>Calculator</span>
		</button>
		<button class="bottom-nav-item" data-page="history">
			<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
			</svg>
			<span>History</span>
		</button>
		<button class="bottom-nav-item" data-page="about">
			<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<circle cx="12" cy="12" r="10"/>
				<path d="M12 16v-4m0-4h.01"/>
			</svg>
			<span>About</span>
		</button>
	</nav>

    <script>
	
	
		// Add this before your existing initialization code
		class Typewriter {
			constructor(element, messages, options = {}) {
				this.element = element;
				this.messages = messages;
				this.currentMessageIndex = 0;
				this.currentText = '';
				this.letterIndex = 0;
				this.typingSpeed = options.typingSpeed || 100;
				this.deletingSpeed = options.deletingSpeed || 50;
				this.pauseDuration = options.pauseDuration || 2000;
				this.isDeleting = false;
				this.cursor = document.createElement('span');
				this.cursor.className = 'typewriter-cursor';
				this.element.parentNode.insertBefore(this.cursor, this.element.nextSibling);
			}

			type() {
				const currentMessage = this.messages[this.currentMessageIndex];
				
				if (this.isDeleting) {
					this.currentText = currentMessage.substring(0, this.letterIndex - 1);
					this.letterIndex--;
				} else {
					this.currentText = currentMessage.substring(0, this.letterIndex + 1);
					this.letterIndex++;
				}

				this.element.textContent = this.currentText;

				let typeSpeed = this.isDeleting ? this.deletingSpeed : this.typingSpeed;

				if (!this.isDeleting && this.letterIndex === currentMessage.length) {
					typeSpeed = this.pauseDuration;
					this.isDeleting = true;
				} else if (this.isDeleting && this.letterIndex === 0) {
					this.isDeleting = false;
					this.currentMessageIndex++;
					if (this.currentMessageIndex === this.messages.length) {
						this.currentMessageIndex = 0;
					}
				}

				setTimeout(() => this.type(), typeSpeed);
			}
		}

	
	
	
	
        // Initialize variables
		let currentCalculator = 'logReduction';
		let darkMode = localStorage.getItem('darkMode') === 'false';
		let calculationHistory = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
		let currentIndex = 0;

		// Initialize app when DOM is loaded
		document.addEventListener('DOMContentLoaded', () => {
			updateDeleteButtonStyle();
			initializeApp();
		});


		function createRipple(event) {
			const button = event.currentTarget;
			const ripple = document.createElement('span');
			const rect = button.getBoundingClientRect();
			
			const diameter = Math.max(rect.width, rect.height);
			const radius = diameter / 2;
			
			ripple.style.width = ripple.style.height = `${diameter}px`;
			ripple.style.left = `${event.clientX - rect.left - radius}px`;
			ripple.style.top = `${event.clientY - rect.top - radius}px`;
			ripple.classList.add('ripple');
			
			const existingRipple = button.querySelector('.ripple');
			if (existingRipple) {
				existingRipple.remove();
			}
			
			button.appendChild(ripple);
			
			ripple.addEventListener('animationend', () => {
				ripple.remove();
			});
		}

		function createTitleElements(titleId) {
			const titleElement = document.getElementById(titleId);
			if (!titleElement) return null;

			// Create container
			const container = document.createElement('div');
			container.className = 'title-container';

			// Create shadow element
			const shadow = document.createElement('div');
			shadow.className = 'title-shadow';

			// Create cursor element
			const cursor = document.createElement('span');
			cursor.className = 'title-cursor';

			// Move the title element into the container
			titleElement.parentNode.insertBefore(container, titleElement);
			container.appendChild(titleElement);
			container.appendChild(cursor);
			container.appendChild(shadow);

			return { container, titleElement, cursor, shadow };
		}

		function initializeTitle(titleId, text) {
			const titleElement = document.getElementById(titleId);
			if (!titleElement) return;

			let index = 0;
			
			// Create wrapper div
			const wrapper = document.createElement('div');
			wrapper.style.position = 'relative';
			titleElement.parentNode.insertBefore(wrapper, titleElement);
			wrapper.appendChild(titleElement);
			
			// Create cursor
			const cursor = document.createElement('span');
			cursor.className = 'title-cursor';
			wrapper.appendChild(cursor);
			
			// Create shadow
			const shadow = document.createElement('div');
			shadow.className = 'title-shadow';
			wrapper.appendChild(shadow);
			
			function type() {
				if (index < text.length) {
					titleElement.textContent += text.charAt(index);
					index++;
					// Update shadow width to match text width
					requestAnimationFrame(() => {
						shadow.style.width = `${titleElement.offsetWidth}px`;
					});
					setTimeout(type, 100);
				}
			}
			
			return {
				type,
				reset: () => {
					index = 0;
					titleElement.textContent = '';
					shadow.style.width = '0';
				}
			};
		}

		function initializeAboutTitle() {
			const titleControl = initializeTitle('about-title', 'MyLAB');
			if (!titleControl) return;

			const observer = new MutationObserver((mutations) => {
				mutations.forEach((mutation) => {
					if (mutation.target.classList.contains('active')) {
						titleControl.reset();
						titleControl.type();
					}
				});
			});
			
			observer.observe(document.getElementById('aboutPage'), {
				attributes: true,
				attributeFilter: ['class']
			});
		}


		function initializeHistoryTitle() {
			const titleControl = initializeTitle('history-title', 'Calculation History');
			if (!titleControl) return;

			const observer = new MutationObserver((mutations) => {
				mutations.forEach((mutation) => {
					if (mutation.target.classList.contains('active')) {
						titleControl.reset();
						titleControl.type();
					}
				});
			});
			
			observer.observe(document.getElementById('historyPage'), {
				attributes: true,
				attributeFilter: ['class']
			});
		}


		let isNavVisible = true; // Changed to true for initial visibility
		let lastScrollY = 0;
		let scrollTimeout = null;

		function initializeNavToggle() {
			const navToggle = document.querySelector('.nav-toggle');
			const bottomNav = document.querySelector('.bottom-nav');
			const container = document.querySelector('.container');
			
			// Show navigation by default
			bottomNav.classList.remove('hidden');
			bottomNav.classList.add('visible');
			navToggle.classList.add('active');
			navToggle.classList.remove('hidden');
			
			// Toggle navigation on button click
			navToggle.addEventListener('click', () => {
				isNavVisible = !isNavVisible;
				navToggle.classList.toggle('active', isNavVisible);
				navToggle.classList.toggle('hidden', !isNavVisible);
				bottomNav.classList.toggle('hidden', !isNavVisible);
				bottomNav.classList.toggle('visible', isNavVisible);
				
				// Update container padding when nav is toggled
				if (isNavVisible) {
					container.style.paddingBottom = `${parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--footer-height'))}px`;
				} else {
					container.style.paddingBottom = '0';
				}
			});
			
			// Handle scroll behavior
			let lastScrollY = container.scrollTop;
			let scrollTimeout = null;
			
			container.addEventListener('scroll', () => {
				if (scrollTimeout) {
					clearTimeout(scrollTimeout);
				}
				
				scrollTimeout = setTimeout(() => {
					const currentScroll = container.scrollTop;
					
					// Only hide nav when scrolling down AND nav is currently visible
					// Remove auto-show on scroll up
					if (currentScroll > lastScrollY && currentScroll > 100 && isNavVisible) {
						isNavVisible = false;
						navToggle.classList.remove('active');
						navToggle.classList.add('hidden');
						bottomNav.classList.remove('visible');
						bottomNav.classList.add('hidden');
						container.style.paddingBottom = '0';
					}
					
					lastScrollY = currentScroll;
				}, 150);
			});
		}

		function initializeApp() {
			if (darkMode) {
				document.body.classList.add('dark');
			}
			
			const typewriterElement = document.getElementById('typewriter');
			const messages = [
				"Hi, Scientist!",
				"Discover MyLAB!",
				"A Science Hub!",
				"Let's Explore!",
				"Examine!",
				"Measure!",
				"Evaluate!",
				"Scrutinize!",
				"Elucidate!",
				"And, Analyze!"
			];
			
			const typewriter = new Typewriter(typewriterElement, messages, {
				typingSpeed: 100,
				deletingSpeed: 50,
				pauseDuration: 2000
			});
			
			initializeNavToggle();
			
			typewriter.type();
			initializeAboutTitle();
			initializeHistoryTitle(); // Add this line
			
			setupEventListeners();
			setupCardStack();
			updateCardPositions(0);
			switchCalculator('logReduction');
			updateHistoryDisplay();
		}

		function setupPageSwipe() {
			const container = document.querySelector('.container');
			let touchStartX = 0;
			let touchEndX = 0;
			let touchStartY = 0;
			const pages = ['calculator', 'history', 'about'];
			let isVerticalScroll = false;

			container.addEventListener('touchstart', (e) => {
				// Ignore if touch started inside calculator menu
				if (e.target.closest('.calculator-menu')) return;

				touchStartX = e.touches[0].clientX;
				touchStartY = e.touches[0].pageY;
				isVerticalScroll = false;
			});

			container.addEventListener('touchmove', (e) => {
				// Ignore if touch started inside calculator menu
				if (e.target.closest('.calculator-menu')) return;
				if (isVerticalScroll) return;

				const touchMoveX = e.touches[0].clientX;
				const touchMoveY = e.touches[0].pageY;
				const diffX = Math.abs(touchMoveX - touchStartX);
				const diffY = Math.abs(touchMoveY - touchStartY);

				// Determine if the user is trying to scroll vertically
				if (diffY > diffX && diffY > 10) {
					isVerticalScroll = true;
				}
			});

			container.addEventListener('touchend', (e) => {
				// Ignore if touch started inside calculator menu
				if (e.target.closest('.calculator-menu')) return;
				if (isVerticalScroll) return;

				touchEndX = e.changedTouches[0].clientX;
				const swipeDistance = touchEndX - touchStartX;
				const threshold = 100; // Minimum swipe distance

				if (Math.abs(swipeDistance) < threshold) return;

				const currentPage = document.body.className.includes('calculator-page') ? 'calculator' :
								  document.querySelector('.page.active').id.replace('Page', '');
				const currentIndex = pages.indexOf(currentPage);

				let newIndex;
				if (swipeDistance > 0) {
					// Swipe right - go to previous page
					newIndex = (currentIndex - 1 + pages.length) % pages.length;
				} else {
					// Swipe left - go to next page
					newIndex = (currentIndex + 1) % pages.length;
				}

				const newPage = pages[newIndex];
				switchPage(newPage);
				updateBottomNav(newPage);
			});
		}

		function setupEventListeners() {
			// Dark mode toggle
			document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
			
			// Reset button
			document.getElementById('resetButton').addEventListener('click', handleReset);
			
			// Calculator buttons
			document.querySelectorAll('.calculator-button').forEach((button, index) => {
				button.addEventListener('click', () => {
					const calculatorId = button.getAttribute('data-calculator');
					currentIndex = index;
					updateCardPositions(currentIndex);
					switchCalculator(calculatorId);
				});
			});


			// Add page swipe functionality
			setupPageSwipe();
			
			// Bottom navigation
			document.querySelectorAll('.bottom-nav-item').forEach(item => {
				item.addEventListener('click', () => {
					const page = item.getAttribute('data-page');
					switchPage(page);
					updateBottomNav(page);
				});
			});
			
			// Add to your setupEventListeners function
			document.querySelectorAll('.bottom-nav-item').forEach(button => {
				button.addEventListener('click', createRipple);
			});

			// Search functionality
			const searchInput = document.getElementById('calculatorSearch');
			if (searchInput) {
				searchInput.addEventListener('input', handleSearch);
			}
		}

        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark', darkMode);
            localStorage.setItem('darkMode', darkMode);
            
            const icon = document.querySelector('.dark-mode-icon');
            icon.style.transform = 'rotate(360deg)';
            
            setTimeout(() => {
                icon.innerHTML = darkMode ? 
                    '<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>' :
                    '<circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>';
                icon.style.transform = '';
            }, 300);
        }

        function handleReset() {
            const icon = document.querySelector('#resetButton svg');
            icon.style.transform = 'rotate(360deg)';
            
            setTimeout(() => {
                resetInputs();
                icon.style.transform = '';
            }, 300);
        }

		function handleSearch(e) {
			const searchTerm = e.target.value.toLowerCase();
			const buttons = document.querySelectorAll('.calculator-button');
			let firstMatchIndex = -1;
			
			// Reset all calculator sections to hidden first
			document.querySelectorAll('.calculator-section').forEach(section => {
				section.style.display = 'none';
				section.style.opacity = '0';
				section.style.transform = 'translateY(10px) scale(0.98)';
			});
			
			// First, remove all positioning classes
			buttons.forEach(button => {
				button.classList.remove('active', 'next', 'prev');
				button.style.display = 'none'; // Hide all buttons initially
			});
			
			// Find all matching buttons and show them
			let matchingButtons = Array.from(buttons).filter((button, index) => {
				const title = button.querySelector('.calculator-title').textContent.toLowerCase();
				const description = button.querySelector('.calculator-description').textContent.toLowerCase();
				const matches = title.includes(searchTerm) || description.includes(searchTerm);
				
				if (matches && searchTerm !== '') {
					button.style.display = 'flex'; // Show matching buttons
					if (firstMatchIndex === -1) firstMatchIndex = index;
					return true;
				}
				return false;
			});
			
			// If no search term, show all buttons
			if (searchTerm === '') {
				buttons.forEach(button => button.style.display = 'flex');
				matchingButtons = Array.from(buttons);
				firstMatchIndex = currentIndex;
			}
			
			// If we have matches, update the display
			if (matchingButtons.length > 0) {
				const activeIndex = firstMatchIndex;
				currentIndex = activeIndex;
				
				// Update positions for matching buttons
				matchingButtons.forEach((button, i) => {
					if (i === 0) {
						button.classList.add('active');
						const calculatorId = button.getAttribute('data-calculator');
						switchCalculator(calculatorId);
					} else if (i === 1) {
						button.classList.add('next');
					} else if (i === matchingButtons.length - 1 && i !== 0) {
						button.classList.add('prev');
					}
				});
			} else if (searchTerm === '') {
				// If search is cleared, restore normal view
				updateCardPositions(currentIndex);
				const currentButton = buttons[currentIndex];
				if (currentButton) {
					const calculatorId = currentButton.getAttribute('data-calculator');
					switchCalculator(calculatorId);
				}
			}
		}


		// Modify setupCardStack() for better mobile handling
		function setupCardStack() {
			const buttons = document.querySelectorAll('.calculator-button');
			buttons.forEach((button, index) => {
				if (index === currentIndex) {
					button.classList.add('active');
				} else if (index === (currentIndex + 1) % buttons.length) {
					button.classList.add('next');
				} else if (index === (currentIndex - 1 + buttons.length) % buttons.length) {
					button.classList.add('prev');
				}
			});

			let touchStartX = 0;
			let touchEndX = 0;
			let isSwiping = false;
			let touchStartY = 0;
			let isVerticalScroll = false;

			const menu = document.querySelector('.calculator-menu');

			menu.addEventListener('touchstart', (e) => {
				touchStartX = e.touches[0].clientX;
				touchStartY = e.touches[0].pageY;
				isSwiping = false;
				isVerticalScroll = false;
			});

			menu.addEventListener('touchmove', (e) => {
				if (isVerticalScroll) return;

				const touchMoveX = e.touches[0].clientX;
				const touchMoveY = e.touches[0].pageY;
				const diffX = Math.abs(touchMoveX - touchStartX);
				const diffY = Math.abs(touchMoveY - touchStartY);

				// Determine if the user is trying to scroll vertically
				if (diffY > diffX && diffY > 10) {
					isVerticalScroll = true;
					return;
				}

				// If horizontal movement is significant, prevent default to avoid page scrolling
				if (diffX > 10) {
					e.preventDefault();
					isSwiping = true;
				}
			}, { passive: false });

			menu.addEventListener('touchend', (e) => {
				if (isVerticalScroll) return;

				touchEndX = e.changedTouches[0].clientX;
				const swipeDistance = touchEndX - touchStartX;

				if (!isSwiping) {
					// Handle tap
					const button = e.target.closest('.calculator-button');
					if (button) {
						const calculatorId = button.getAttribute('data-calculator');
						const index = Array.from(buttons).indexOf(button);
						currentIndex = index;
						updateCardPositions(index);
						switchCalculator(calculatorId);
					}
				} else if (Math.abs(swipeDistance) > 50) {
					// Handle swipe only if it's significant
					if (swipeDistance > 0) {
						cycleCards('prev');
					} else {
						cycleCards('next');
					}
				}
			});

			// Optional: Add mouse wheel event for desktop
			menu.addEventListener('wheel', (e) => {
				e.preventDefault();
				if (e.deltaY > 0) {
					cycleCards('next');
				} else {
					cycleCards('prev');
				}
			});
		}

        function cycleCards(direction) {
            const buttons = document.querySelectorAll('.calculator-button');
            const totalCards = buttons.length;

            buttons.forEach(btn => {
                btn.classList.remove('active', 'prev', 'next');
            });

            if (direction === 'next') {
                currentIndex = (currentIndex + 1) % totalCards;
            } else {
                currentIndex = (currentIndex - 1 + totalCards) % totalCards;
            }

            updateCardPositions(currentIndex);

            // Update calculator
            const newActiveButton = buttons[currentIndex];
            const calculatorId = newActiveButton.getAttribute('data-calculator');
            switchCalculator(calculatorId);
        }

        function updateCardPositions(activeIndex) {
            const buttons = document.querySelectorAll('.calculator-button');
            const totalCards = buttons.length;

            buttons.forEach((button, index) => {
                button.classList.remove('active', 'prev', 'next');
                
                if (index === activeIndex) {
                    button.classList.add('active');
                } else if (index === (activeIndex + 1) % totalCards) {
                    button.classList.add('next');
                } else if (index === (activeIndex - 1 + totalCards) % totalCards) {
                    button.classList.add('prev');
                }
            });
        }

		// Enhance calculator switching
		function switchCalculator(calculatorId) {
			const sections = document.querySelectorAll('.calculator-section');
			currentCalculator = calculatorId;
			
			sections.forEach(section => {
				if (section.id === calculatorId) {
					// Show the selected calculator with animation
					section.style.display = 'block';
					requestAnimationFrame(() => {
						section.style.opacity = '1';
						section.style.transform = 'translateY(0) scale(1)';
					});
				} else {
					// Hide other calculators
					section.style.opacity = '0';
					section.style.transform = 'translateY(10px) scale(0.98)';
					setTimeout(() => {
						if (section.style.opacity === '0') {
							section.style.display = 'none';
						}
					}, 200);
				}
			});

			// Clear any previous results when switching calculators
			sections.forEach(section => {
				const resultDiv = section.querySelector('.result');
				if (resultDiv) {
					resultDiv.style.display = 'none';
				}
			});

			// Reset inputs of the non-active calculators
			sections.forEach(section => {
				if (section.id !== calculatorId) {
					const inputs = section.querySelectorAll('input');
					inputs.forEach(input => {
						input.value = '';
					});
				}
			});
		}

        // Calculation Functions with Step-by-Step Display
        function calculateLogReduction() {
            const initial = parseFloat(document.getElementById('initialCount').value);
            const final = parseFloat(document.getElementById('finalCount').value);
            
            if (initial && final && initial > final) {
                const reduction = Math.log10(initial / final);
                const percentage = (1 - (final / initial)) * 100;
                
                // Create steps HTML
                const stepsHtml = `
                    <div class="calculation-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <div class="step-title">Input Values</div>
                                <p>Initial Count (N₀) = ${initial.toLocaleString()} CFU/mL</p>
                                <p>Final Count (N) = ${final.toLocaleString()} CFU/mL</p>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <div class="step-title">Calculate Ratio</div>
                                <div class="step-formula">N₀/N = ${initial.toLocaleString()} / ${final.toLocaleString()} = ${(initial/final).toFixed(4)}</div>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <div class="step-title">Calculate Log₁₀</div>
                                <div class="step-formula">Log₁₀(${(initial/final).toFixed(4)}) = ${reduction.toFixed(4)}</div>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <div class="step-title">Percentage Reduction</div>
                                <div class="step-formula">(1 - ${final.toLocaleString()}/${initial.toLocaleString()}) × 100 = ${percentage.toFixed(2)}%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result">
                        <div class="result-title">Final Results</div>
                        <div class="result-value">${reduction.toFixed(2)} log₁₀ reduction</div>
                        <div class="result-note">
                            This represents a ${percentage.toFixed(2)}% reduction in microbial count
                        </div>
                    </div>
                `;
                
                displayResult('logReduction', stepsHtml);
                addToHistory('Log Reduction', `${reduction.toFixed(2)} log₁₀`, { initialCount: initial, finalCount: final });
            }
        }

        function calculateDilution() {
            const stockConc = parseFloat(document.getElementById('stockConc').value);
            const targetConc = parseFloat(document.getElementById('targetConc').value);
            const finalVolume = parseFloat(document.getElementById('finalVolume').value);
            
            if (stockConc && targetConc && finalVolume && targetConc < stockConc) {
                const stockVolume = (targetConc * finalVolume) / stockConc;
                const diluentVolume = finalVolume - stockVolume;
                
                const stepsHtml = `
                    <div class="calculation-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <div class="step-title">Input Values</div>
                                <p>Stock Concentration (C₁) = ${stockConc}%</p>
                                <p>Target Concentration (C₂) = ${targetConc}%</p>
                                <p>Final Volume (V₂) = ${finalVolume} mL</p>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <div class="step-title">Calculate Stock Volume using C₁V₁ = C₂V₂</div>
                                <div class="step-formula">
                                    V₁ = (C₂ × V₂) / C₁<br>
                                    V₁ = (${targetConc} × ${finalVolume}) / ${stockConc}<br>
                                    V₁ = ${stockVolume.toFixed(2)} mL
                                </div>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <div class="step-title">Calculate Diluent Volume</div>
                                <div class="step-formula">
                                    Diluent = Final Volume - Stock Volume<br>
                                    Diluent = ${finalVolume} - ${stockVolume.toFixed(2)}<br>
                                    Diluent = ${diluentVolume.toFixed(2)} mL
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result">
                        <div class="result-title">Final Results</div>
                        <div class="result-value">Stock solution needed: ${stockVolume.toFixed(2)} mL</div>
                        <div class="result-note">
                            Add ${diluentVolume.toFixed(2)} mL of diluent.<br>
                            To achieve ${targetConc}% final concentration
                        </div>
                    </div>
                `;
                
                displayResult('dilution', stepsHtml);
                addToHistory('Dilution', `${stockVolume.toFixed(2)} mL stock needed`, 
                    { stockConc, targetConc, finalVolume });
            }
        }

		function calculateCFU() {
			const colonies = parseFloat(document.getElementById('colonies').value);
			const dilutionFactor = parseFloat(document.getElementById('dilutionFactor').value);
			const platedVolume = parseFloat(document.getElementById('platedVolume').value);
			
			if (colonies && dilutionFactor && platedVolume) {
				const cfu = (colonies * dilutionFactor) / platedVolume;
				
				// Format the CFU value with superscript
				const formattedCFU = formatScientificNotation(cfu);
				
				const stepsHtml = `
					<div class="calculation-steps">
						<div class="step">
							<div class="step-number">1</div>
							<div class="step-content">
								<div class="step-title">Input Values</div>
								<p>Colony Count = ${colonies}</p>
								<p>Dilution Factor = ${dilutionFactor}</p>
								<p>Plated Volume = ${platedVolume} mL</p>
							</div>
						</div>
						
						<div class="step">
							<div class="step-number">2</div>
							<div class="step-content">
								<div class="step-title">Calculate CFU/mL</div>
								<div class="step-formula">
									CFU/mL = (Colony Count × Dilution Factor) / Plated Volume<br>
									CFU/mL = (${colonies} × ${dilutionFactor}) / ${platedVolume}<br>
									CFU/mL = ${formattedCFU}
								</div>
							</div>
						</div>
					</div>
					
					<div class="result">
						<div class="result-title">Final Results</div>
						<div class="result-value">${formattedCFU}</div>
						<div class="result-note">
							Based on ${colonies} colonies at ${dilutionFactor}× dilution.<br>
							Plated volume: ${platedVolume} mL
						</div>
					</div>
				`;
				
				displayResult('cfu', stepsHtml);
				addToHistory('CFU', formattedCFU, 
					{ colonies, dilutionFactor, platedVolume });
			}
		}

		// Helper function to format scientific notation
		function formatScientificNotation(num) {
			const exp = Math.floor(Math.log10(num));
			const base = (num / Math.pow(10, exp)).toFixed(2);
			return `${base}×10<sup>${exp}</sup> CFU/mL`;
		}

        function calculateMedia() {
			const volume = parseFloat(document.getElementById('mediaVolume').value);
			const concentration = parseFloat(document.getElementById('mediaConc').value);
			const molecularWeight = parseFloat(document.getElementById('molecularWeight').value);
            
			if (volume && concentration && molecularWeight) {
				const molarConcentration = concentration / 1000; // Convert mM to M
				const mass = (concentration * volume * molecularWeight) / 1000;
                
                const stepsHtml = `
                    <div class="calculation-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <div class="step-title">Input Values</div>
                                <p>Final Volume = ${volume} L</p>
                                <p>Concentration = ${concentration} mM</p>
                                <p>Molecular Weight = ${molecularWeight} g/mol</p>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <div class="step-title">Convert mM to M</div>
                                <div class="step-formula">
                                    ${concentration} mM = ${molarConcentration} M
                                </div>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <div class="step-title">Calculate Mass</div>
                                <div class="step-formula">
                                    Mass = Concentration (M) × Volume (L) × Molecular Weight (g/mol)<br>
                                    Mass = ${molarConcentration} × ${volume} × ${molecularWeight}<br>
                                    Mass = ${mass.toFixed(3)} g
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result">
                        <div class="result-title">Final Results</div>
                        <div class="result-value">${mass.toFixed(3)} g required</div>
                        <div class="result-note">
                            Dissolve in ${volume} L of solvent.<br>
                            To achieve ${concentration} mM concentration
                        </div>
                    </div>
                `;
                
				displayResult('media', stepsHtml);
				addToHistory('Media', `${mass.toFixed(3)} g required`, {
					volume,
					concentration,
					molecularWeight
				});
			}
		}

		function displayResult(calculatorId, html) {
			const resultDiv = document.getElementById(`${calculatorId}Result`);
			if (!resultDiv) return;
			
			const formattedHtml = html.replace(/(\d{6,})/g, (match) => {
				return match.replace(/(\d{3})/g, '$1,');
			});
			
			resultDiv.innerHTML = formattedHtml;
			resultDiv.style.display = 'block';
			resultDiv.style.opacity = '0';
			
			requestAnimationFrame(() => {
				resultDiv.style.opacity = '1';
				resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
			});
		}

		function addToHistory(type, result, inputs) {
			// Create a mapping of the input fields to their standardized keys
			let standardizedInputs = {};
			
			switch(type) {
				case 'Media':
					standardizedInputs = {
						mediaVolume: inputs.volume,
						mediaConc: inputs.concentration,
						molecularWeight: inputs.molecularWeight
					};
					break;
				default:
					standardizedInputs = inputs;
			}
			
			const entry = {
				id: Date.now(),
				type,
				result,
				inputs: standardizedInputs,
				timestamp: new Date().toLocaleString()
			};
			
			calculationHistory.unshift(entry);
			if (calculationHistory.length > 10) calculationHistory.pop();
			
			localStorage.setItem('calculationHistory', JSON.stringify(calculationHistory));
			updateHistoryDisplay();
		}

		function updateHistoryDisplay() {
			const historyList = document.getElementById('historyList');
			if (!historyList) return;
			
			if (calculationHistory.length === 0) {
				historyList.innerHTML = `
					<div class="history-empty">
						<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin-bottom: 1rem; opacity: 0.5;">
							<path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/>
						</svg>
						<p>No calculations yet</p>
						<p style="font-size: 0.9em;">Your calculation history will appear here</p>
					</div>
				`;
				return;
			}
			
			const getTypeStyles = (type) => {
				const styles = {
					'Log Reduction': {
						gradient: 'var(--log-reduction)',
						icon: '<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>'
					},
					'Dilution': {
						gradient: 'var(--dilution)',
						icon: '<path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 19h14.56l-5.069-8.577a2 2 0 0 1-.211-.896V2"/><path d="M8.5 2h7"/><path d="M7 16h10"/>'
					},
					'CFU': {
						gradient: 'var(--cfu)',
						icon: '<circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8"/>'
					},
					'Media': {
						gradient: 'var(--media)',
						icon: '<path d="M9 3h6v11a6 6 0 0 1-3 5.197A6 6 0 0 1 9 14V3"/><path d="M9 8h6"/>'
					}
				};
				return styles[type] || styles['Log Reduction'];
			};
			
			historyList.innerHTML = calculationHistory.map(entry => {
				const typeStyle = getTypeStyles(entry.type);
				return `
					<div class="history-entry">
						<div class="result" data-id="${entry.id}" 
							 onclick="restoreCalculation(${entry.id})" 
							 style="background: ${typeStyle.gradient}; border: none; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">
							<button class="delete-history" onclick="deleteHistoryEntry(${entry.id}, event)" aria-label="Delete entry">
								<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
									<path d="M18 6L6 18M6 6l12 12"/>
								</svg>
							</button>
							<div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
								<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
									${typeStyle.icon}
								</svg>
								<div class="result-title" style="color: white; margin: 0;">${entry.type} • ${entry.timestamp}</div>
							</div>
							<div class="result-value" style="color: white;">${formatValue(entry.result)}</div>
							<div class="result-note" style="color: rgba(255, 255, 255, 0.9);">${formatInputs(entry.inputs)}</div>
						</div>
					</div>
				`;
			}).join('');
		}


		// Update the deleteHistoryEntry styling for better visibility on colored backgrounds
		function updateDeleteButtonStyle() {
			const style = document.createElement('style');
			style.textContent = `
				.delete-history {
					background: rgba(255, 255, 255, 0.2);
					color: white;
					border: 1px solid rgba(255, 255, 255, 0.3);
				}
				
				.delete-history:hover {
					background: rgba(255, 255, 255, 0.3);
				}
			`;
			document.head.appendChild(style);
		}

		// ADD these new helper functions:
		function formatValue(value) {
			if (typeof value === 'string' && value.includes('e+')) {
				// Convert scientific notation to superscript format
				const [num, exp] = value.split('e+');
				const baseNum = parseFloat(num).toFixed(2);
				return `${baseNum}×10${exp} CFU/mL`.replace(exp, `<sup>${exp}</sup>`);
			}
			return value;
		}


		// Add new function for deleting history entries
		function deleteHistoryEntry(id, event) {
			event.stopPropagation();  // Prevent triggering restore
			calculationHistory = calculationHistory.filter(entry => entry.id !== id);
			localStorage.setItem('calculationHistory', JSON.stringify(calculationHistory));
			updateHistoryDisplay();
		}

		function formatInputs(inputs) {
			return Object.entries(inputs)
				.map(([key, value]) => {
					const formattedKey = key.replace(/([A-Z])/g, ' $1').toLowerCase();
					const formattedValue = value > 999999 ? 
						value.toExponential(2).replace('e+', '×10^') : 
						value.toLocaleString();
					return `${formattedKey}: ${formattedValue}`;
				})
				.join(' | ');
		}

		function restoreCalculation(historyId) {
			const entry = calculationHistory.find(e => e.id === historyId);
			if (!entry) return;

			switchPage('calculator');
			
			setTimeout(() => {
				const buttons = document.querySelectorAll('.calculator-button');
				const calculatorId = getCalculatorId(entry.type);
				const buttonIndex = Array.from(buttons).findIndex(btn => 
					btn.getAttribute('data-calculator') === calculatorId
				);
				
				if (buttonIndex !== -1) {
					currentIndex = buttonIndex;
					updateCardPositions(currentIndex);
				}
				
				switchCalculator(calculatorId);
				
				setTimeout(() => {
					// Loop through each input in the history entry
					Object.entries(entry.inputs).forEach(([key, value]) => {
						const input = document.getElementById(key);
						if (input) {
							input.value = value;
							// Add highlight animation
							input.style.animation = 'highlight 0.5s ease-out';
							input.addEventListener('animationend', () => {
								input.style.animation = '';
							}, { once: true });
						}
					});
					
					// Force recalculation after restoration
					switch(calculatorId) {
						case 'logReduction':
							calculateLogReduction();
							break;
						case 'dilution':
							calculateDilution();
							break;
						case 'cfu':
							calculateCFU();
							break;
						case 'media':
							calculateMedia();
							break;
					}
				}, 300);
			}, 300);
		}

        function getCalculatorId(type) {
            const mapping = {
                'Log Reduction': 'logReduction',
                'Dilution': 'dilution',
                'CFU': 'cfu',
                'Media': 'media'
            };
            return mapping[type] || 'logReduction';
        }

		function switchPage(page) {
			const pages = document.querySelectorAll('.page');
			const targetPage = document.getElementById(`${page}Page`);
			const container = document.querySelector('.container');
			
			// Reset scroll position smoothly
			container.scrollTo({
				top: 0,
				behavior: 'smooth'
			});
			
			document.body.className = page === 'calculator' ? 'calculator-page' : '';
			if (darkMode) document.body.classList.add('dark');
			
			// Handle page transitions
			pages.forEach(p => {
				if (p === targetPage) {
					p.style.display = 'block';
					requestAnimationFrame(() => {
						p.classList.add('active');
					});
				} else {
					p.classList.remove('active');
					// Wait for transition to complete before hiding
					setTimeout(() => {
						if (!p.classList.contains('active')) {
							p.style.display = 'none';
						}
					}, 400); // Match the transition duration
				}
			});
			
			// Update navigation
			updateBottomNav(page);
		}

        function resetInputs() {
            const currentSection = document.getElementById(currentCalculator);
            if (!currentSection) return;

            const inputs = currentSection.querySelectorAll('input');
            const result = currentSection.querySelector('.result');
            
            inputs.forEach(input => {
                input.value = '';
            });
            
            if (result) {
                result.style.opacity = '0';
                setTimeout(() => {
                    result.style.display = 'none';
                }, 300);
            }
        }

        function updateBottomNav(page) {
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                const isActive = item.getAttribute('data-page') === page;
                item.classList.toggle('active', isActive);
            });
        }
    </script>
</body>
</html>